<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สรุปผลโหวต</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="min-h-screen">
        <header class="bg-green-600 text-white shadow-lg">
            <div class="container mx-auto py-6 px-4">
                 <h1 class="text-3xl md:text-4xl font-bold text-center">สรุปผลโหวตครูในดวงใจ</h1>
            </div>
        </header>
        <main class="container mx-auto px-4 py-8">
            <div id="loading" class="text-center">
                <p class="text-xl text-green-700">กำลังโหลดข้อมูลสรุปผล...</p>
            </div>
            <div id="main-content" class="hidden">
                <h2 class="text-2xl font-semibold text-green-800 mb-4 text-center">เลือกกลุ่มสาระเพื่อดูผลสรุป</h2>
                <div id="subject-selector" class="flex flex-wrap gap-2 mb-8 justify-center"></div>
                <h3 id="summary-subject-title" class="text-2xl font-bold text-green-800 mb-6 text-center"></h3>
                <div id="summary-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>
        </main>
    </div>

<script>
    // ===================================================================
    //  สำคัญ! แก้ไข URL ตรงนี้เป็น Web App URL เดียวกับไฟล์ script.js
    // ===================================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbye0lPT3J6Clg9N6aQCl-S2z68z4qgM-4cRp7yrH6YhpHewR2L3wgHdkaxFhhDqcn67hg/exec";
    
    // ===================================================================
    //  สำคัญ! ข้อมูลส่วนนี้ต้องถูกคัดลอกมาจากไฟล์ script.js
    // ===================================================================
    const teachersData = {
         math: [
        { id: 'math1', name: 'นางสาวปณิชา  น้ำแก้ว', image: 'phonwipha.jpg' },
        { id: 'math2', name: 'นางสุมีนา  ทับเนียม', image: 'kanokwan.jpg' },
        { id: 'math3', name: 'นางสาวสุดา  สมอแก้ว', image: 'saisamon.jpg' },
        { id: 'math4', name: 'นางสาวบงกชกุล  วงษ์สีทอง', image: 'supattra2.jpg' },
        { id: 'math5', name: 'นายทรงเกียรติ มณีโชติชุติมา', image: 'suriyo.jpg' },
        { id: 'math6', name: 'นางสาวกองกาญจน์ ทิพย์จันทร์', image: 'natthamon.jpg' },
        { id: 'math7', name: 'นางสาวเพ็ญพิชชา  วรศักตยานันต์', image: 'itsaraphon.jpg' },
        { id: 'math8', name: 'นางสาวพิศุทธิ์  แย้มบุตร', image: 'oraya.jpg' },
        { id: 'math9', name: 'นางสาวศิริพร  สุขเกษม', image: 'supamat.jpg' },
        { id: 'math10', name: 'นางสาวธีร์วรา ทับชุม', image: 'ampika.jpg' },
        { id: 'math11', name: 'นางสาวณัฎฐริณี ช่วยคง', image: 'panadda.jpg' }
    ],
    science: [
        { id: 'sci1', name: 'นางจันทร์เพ็ญ  ศรีภุมมา', image: 'rotsukon.jpg' },
        { id: 'sci2', name: 'นายณัฐวุฒิ  วรรณโชติ', image: 'kitcha.jpg' },
        { id: 'sci3', name: 'นางสาวภาณุมาศ  นักษัตรมณฑล', image: 'naphaphon.jpg' },
        { id: 'sci4', name: 'นายนัสรี สาและ', image: 'phoranee.jpg' },
        { id: 'sci5', name: 'นางสาวณัฐกฤตา  รองพล', image: 'kittithon.jpg' },
        { id: 'sci6', name: 'นางสาวเรณู  อรุณประสิทธิชัย', image: 'chakkraphong.jpg' },
        { id: 'sci7', name: 'นางสาวสุทธิกานต์  เหรียญทอง', image: 'chanakan.jpg' },
        { id: 'sci8', name: 'นางสาวจิณณ์ณณัช  ธาราจิรเศรษฐ์', image: 'nawaphon.jpg' },
        { id: 'sci9', name: 'นางณัฐนรี  แขวงโสภา', image: 'wan.png' },
        { id: 'sci10', name: 'นางสาวระพีพัชร  อินทรโชติ', image: 'sasithon.jpg' },
        { id: 'sci11', name: 'นางสาวลักษิกา  ผลพิมาย', image: 'wanna.jpg' },
        { id: 'sci12', name: 'นางสาวธนาภรณ์  เจริญผล', image: 'pharawee.jpg' },
        { id: 'sci13', name: 'นางสาวพิมชนก  เจริญชีพ', image: 'thansiri.jpg' },
        { id: 'sci14', name: 'นายสุนทร อุ่นทวี', image: 'sirimon.jpg' },
        { id: 'sci15', name: 'นายสุพจน์  วิจิตรเวชการ', image: 'sukon.jpg' },
        { id: 'sci16', name: 'นายปกรณ์ บริบูรณ์ทรัพย์', image: 'thanawit.jpg' },
        { id: 'sci17', name: 'นายพงศ์พัทธ์  เจริญลาภลอย', image: 'thanyathon.jpg' },
        { id: 'sci18', name: 'นายภควรรษ  รัตนภานพ', image: 'butsaraphon.jpg' },
        { id: 'sci19', name: 'นายอัษฎา สังขะจาย', image: 'benjawan.jpg' },
        { id: 'sci20', name: 'นางสาวศศิธร ตรีพิมล', image: 'chakrit.jpg' }
    ],
    thai: [
        { id: 'thai1', name: 'นางสาวสุชิรา แสงทองอร่าม', image: 'jakkrit.jpg' },
        { id: 'thai2', name: 'นางพรอุมา แก้วจิตต์', image: 'kornwan.jpg' },
        { id: 'thai3', name: 'นางสาวปรารถนา จันทร์ไทย', image: 'chanyong.jpg' },
        { id: 'thai4', name: 'นางณัฐิกา ปัตยุรักษ์', image: 'bampen.jpg' },
        { id: 'thai5', name: 'นางสาวกันยกานต์ จันชนะ', image: 'chutima.jpg' },
        { id: 'thai6', name: 'นายเฉลิมศักดิ์ ลาภส่งผล', image: 'rattanasak.jpg' },
        { id: 'thai7', name: 'นางสาวเปรมจิต ชินวงษ์', image: 'thanakorn.jpg' },
        { id: 'thai8', name: 'นางสาวประเทือง บัวเผื่อน', image: 'natthanit.jpg' },
        { id: 'thai9', name: 'นางสาวนงลักษณ์ แดงเพ็ง', image: 'thipphawan.jpg' },
        { id: 'thai10', name: 'นางสาวปัณฑิตา พูลสวัสดิ์', image: 'wirachin.jpg' }
    ],
    foreign: [
        { id: 'foreign1', name: 'นางอริสา ขันโฑ', image: 'chiraphon.jpg' },
        { id: 'foreign2', name: 'นางจำนงจิต ยะโสธร', image: 'nawarat.jpg' },
        { id: 'foreign3', name: 'นางสาวสังวาลย์ จันละมูล', image: 'thamonwan.jpg' },
        { id: 'foreign4', name: 'นางสาวทยากร ศักดิ์ศรีเท้า', image: 'sirada.jpg' },
        { id: 'foreign5', name: 'นางสาวอจิระวดี ไชยบุตร', image: 'duangkamon.jpg' },
        { id: 'foreign6', name: 'นางสาวธนิตา เผ่าพงศ์ษา', image: 'onwan.jpg' },
        { id: 'foreign7', name: 'นายศิลปิน ทิพย์นพคุณ', image: 'worawat.jpg' },
        { id: 'foreign8', name: 'นายธนวัฒน์ โพธิรัชต์', image: 'rattana.jpg' },
        { id: 'foreign9', name: 'นางสาวสุจิรา สุวรรณนัง', image: 'supattra.jpg' },
        { id: 'foreign10', name: 'นางสาวพิราวรรณ ทองปาน', image: 'sawinee.jpg' },
        { id: 'foreign11', name: 'นางสาวฉัตรรดา ประเสริฐศรี', image: 'patiphan.jpg' },
        { id: 'foreign12', name: 'นางสาวปัทมาวดี นิลประดับ', image: 'phattriya.jpg' },
        { id: 'foreign13', name: 'นางสาวปพิชญา กลับประดิษฐ', image: 'wathiphon.jpg' },
        { id: 'foreign14', name: 'Ms. Nerissa  J.  Denilla', image: 'onphat.jpg' },
        { id: 'foreign15', name: 'Mr. Steven J Walden', image: 'panita.jpg' },
        { id: 'foreign16', name: 'Ms. Emily  Mirembe', image: 'siriamphai.jpg' },
        { id: 'foreign17', name: 'Mr. Rusty Nino Felipe Mercado', image: 'nalinphat.jpg' },
        { id: 'foreign18', name: 'Ms. Patricia Maxine Dazo Vergara', image: 'chittima.jpg' },
        { id: 'foreign19', name: 'Ceng Jia qi', image: 'nitchnipha.jpg' }
    ],
    social: [
        { id: 'soc1', name: 'นายชุมสิน กาญจนทอง', image: 'thanakorn2.jpg' },
        { id: 'soc2', name: 'นางสาวรวิปรียา เทศแย้ม', image: 'sireekorn.jpg' },
        { id: 'soc3', name: 'นางสาวบุบผา บุญส่ง', image: 'airin.jpg' },
        { id: 'soc4', name: 'นางสาวภัทรานิษฐ์ แปงต่อม', image: 'praphatson.jpg' },
        { id: 'soc5', 'name': 'นางสาวพรทิพย์ แดงชาติแท้', image: 'phonnipha.jpg' },
        { id: 'soc6', name: 'นายสุระศักดิ์ ด้วงขวิด', image: 'thatsaneeya.jpg' },
        { id: 'soc7', name: 'นายธีรศักดิ์ ชลรัตน์อมฤต', image: 'suphanan.jpg' },
        { id: 'soc8', name: 'ว่าที่ร้อยตรี อนันต์ ชูช่วย', image: 'phatthanan.jpg' },
        { id: 'soc9', name: 'นายจีรยศ สินธุวงษานนท์', image: 'suchada.jpg' },
        { id: 'soc10', name: 'นางสาวจรรยา สุขขา', image: 'chatcha.jpg' }
    ],
    pe: [
        { id: 'pe1', name: 'นายนันทวัฒน์ พรมหาชัย', image: 'theerawut.jpg' },
        { id: 'pe2', name: 'นางพรรณี ครุฑเสม', image: 'chatchawan.jpg' },
        { id: 'pe3', name: 'นายณัฐวุฒิ เชื้อปรางค์', image: 'anuphong.jpg' },
        { id: 'pe4', name: 'นายอาชาวิน บุญเกิด', image: 'amwika.jpg' },
        { id: 'pe5', name: 'นายทวีเกียรติ วงแหวน', image: 'charipot.jpg' }
    ],
    career: [
        { id: 'car1', name: 'นางนฤภร ราชานาค', image: 'jeerawan.jpg' },
        { id: 'car2', name: 'นางชนัญกาญจน์ หอมกลิ่น', image: 'sunaree.jpg' },
        { id: 'car3', name: 'นายโชติปกรณ์ ขวัญมงคล', image: 'porawan.jpg' },
        { id: 'car4', name: 'นางราตรี อรชร', image: 'paiboon.jpg' },
        { id: 'car5', name: 'นางสาวสาวิตรี วงษ์สวรรค์', image: 'parina.jpg' },
        { id: 'car6', name: 'นางสาวปัทมา โสภาเลิศ', image: 'paiboon.jpg' },
        { id: 'car7', name: 'นางสาวสุรางคนา ยงสุวรรณ', image: 'parina.jpg' },
        { id: 'car8', name: 'นางสาวอัญศิกานต์ ยิ้มภากรณ์', image: 'paiboon.jpg' }
    ],
    art: [
        { id: 'art1', name: 'นายตฤณ คงอยู่สุข', image: 'natthakan.jpg' },
        { id: 'art2', name: 'นายพลวัชร สำเรียนรัมย์', image: 'wanlop.jpg' },
        { id: 'art3', name: 'นายปณิธิ คุ้มทรัพย์', image: 'thaworada.jpg' },
        { id: 'art4', name: 'นางสาวดาวรุ่ง เย็นใส', image: 'chiwarat.jpg' },
        { id: 'art5', name: 'นายไพศาล คำหอม', image: 'phanlop.jpg' }
    ],
    guidance: [
        { id: 'gui1', name: 'นางกันยนา สุรชิต', image: 'suwanna.jpg' },
        { id: 'gui2', name: 'นางลักขณา โพธิ์ทองโชติกุล', image: 'natchatichawadee.jpg' },
        { id: 'gui2', name: 'นางสาวประภาภรณ์ รุ่งเรือง', image: 'natchatichawadee.jpg' }
        ]
    };
    const subjectNames = {
        math: 'คณิตศาสตร์',
        science: 'วิทยาศาสตร์และเทคโนโลยี',
        thai: 'ภาษาไทย',
        foreign: 'ภาษาต่างประเทศ',
        social: 'สังคมศึกษา',
        pe: 'สุขศึกษาและพลศึกษา',
        career: 'การงานอาชีพ',
        art: 'ศิลปะ',
        guidance: 'แนะแนว'
    };
    const voteOptions = {
        1: 'สายคอนเทนต์',
        2: 'สายข้อสอบโหด',
        3: 'สายสอนเกินคาบ',
        4: 'สายบันเทิง',
        5: 'สายเจ้าระเบียบ',
        6: 'สายเข้าใจนักเรียน',
        7: 'สายตั้งใจสอน',
        8: 'สายใจดีเมตตา',
        9: 'สายแฟชั่น'
    };

    // --- โค้ดส่วนที่เหลือสำหรับดึงข้อมูลและแสดงผล ---
    const loadingDiv = document.getElementById('loading');
    const mainContentDiv = document.getElementById('main-content');
    const subjectSelector = document.getElementById('subject-selector');
    const summaryContainer = document.getElementById('summary-container');
    const summarySubjectTitle = document.getElementById('summary-subject-title');

    const chartColors = [
        '#4ade80', '#facc15', '#fb923c', '#f87171', '#60a5fa',
        '#c084fc', '#f472b6', '#34d399', '#a78bfa'
    ];

    document.addEventListener('DOMContentLoaded', () => {
        // เพิ่มการตรวจสอบค่าว่างของ teachersData
        if (!teachersData || Object.keys(teachersData).length === 0) {
            loadingDiv.innerHTML = `<p class="text-xl text-red-600">เกิดข้อผิดพลาด: ไม่พบข้อมูล teachersData ในสคริปต์ กรุณาคัดลอกข้อมูลจาก script.js มาวางให้ครบถ้วน</p>`;
            return;
        }

        fetch(SCRIPT_URL)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText}`);
                }
                return response.json();
            })
            .then(summaryData => {
                loadingDiv.classList.add('hidden');
                mainContentDiv.classList.remove('hidden');
                
                Object.keys(teachersData).forEach(subjectKey => {
                    const button = document.createElement('button');
                    button.textContent = subjectNames[subjectKey];
                    button.className = 'btn-subject bg-white border-2 border-green-500 rounded-lg py-2 px-4 text-green-700 font-medium shadow-md hover:bg-green-50';
                    button.onclick = () => showSummary(subjectKey, summaryData);
                    subjectSelector.appendChild(button);
                });
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                loadingDiv.innerHTML = `<p class="text-xl text-red-600">เกิดข้อผิดพลาดในการโหลดข้อมูล: ${error.message}<br><span class="text-base text-gray-600">กรุณาตรวจสอบ URL, การตั้งค่า Deploy (ต้องเป็น Anyone), และการเชื่อมต่ออินเทอร์เน็ต</span></p>`;
            });
    });

    function showSummary(subjectKey, summaryData) {
    summaryContainer.innerHTML = '';
    summarySubjectTitle.textContent = `ผลสรุปกลุ่มสาระ: ${subjectNames[subjectKey]}`;
    
    const subjectTeachers = teachersData[subjectKey];
    const subjectSummary = summaryData[subjectNames[subjectKey]] || {};

    if (!subjectTeachers || subjectTeachers.length === 0) {
        summaryContainer.innerHTML = '<p class="text-center col-span-full">ไม่พบข้อมูลคุณครูในกลุ่มสาระนี้</p>';
        return;
    }

    subjectTeachers.forEach(teacher => {
        const teacherId = teacher.id;
        const teacherResult = subjectSummary[teacherId] || { name: teacher.name, votes: {} };
        
        const card = document.createElement('div');
        card.className = 'bg-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col';
        
        // ==========================================================
        //  !!! ตรวจสอบว่าบรรทัดนี้เริ่มต้นและจบด้วย Backtick (`) !!!
        // ==========================================================
        const infoHtml = `
            <div class="flex items-center mb-4">
                <img src="${teacher.image}" alt="${teacher.name}" class="w-20 h-20 sm:w-24 sm:h-24 rounded-full mr-4 object-cover border-2 border-green-200">
                <div class="flex-grow">
                    <h3 class="text-lg sm:text-xl font-bold text-green-900">${teacher.name}</h3>
                    <p id="top-vote-${teacherId}" class="text-green-600 font-semibold"></p>
                </div>
            </div>`;
        
        const chartHtml = `<div class="flex-grow flex items-center justify-center"><canvas id="chart-${teacherId}"></canvas></div>`;
        card.innerHTML = infoHtml + chartHtml;
        summaryContainer.appendChild(card);
        
        const voteCounts = teacherResult.votes;
        const labels = Object.values(voteOptions);
        const data = Object.keys(voteOptions).map(key => voteCounts[key] || 0);

        let maxVotes = 0;
        let topVoteIndex = -1;
        let totalVotes = 0;
        data.forEach((count, index) => {
            totalVotes += count;
            if (count > maxVotes) {
                maxVotes = count;
                topVoteIndex = index;
            }
        });
        
        const topVoteEl = document.getElementById(`top-vote-${teacherId}`);
        if (topVoteIndex !== -1) {
            topVoteEl.textContent = `สายเด่น: ${voteOptions[topVoteIndex + 1]}`;
        } else {
             topVoteEl.textContent = 'ยังไม่มีผลโหวต';
        }

        if (totalVotes > 0) {
            new Chart(document.getElementById(`chart-${teacherId}`), {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ผลโหวต',
                        data: data,
                        backgroundColor: chartColors,
                        borderColor: '#ffffff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false 
                        }
                    }
                }
            });
        } else {
             document.getElementById(`chart-${teacherId}`).outerHTML = '<p class="text-center text-gray-500 flex-grow flex items-center justify-center">ยังไม่มีข้อมูลกราฟ</p>';
        }
    });
}

        subjectTeachers.forEach(teacher => {
            const teacherId = teacher.id;
            const teacherResult = subjectSummary[teacherId] || { name: teacher.name, votes: {} };
            
            const card = document.createElement('div');
            card.className = 'bg-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col';
            
            const infoHtml = `
                <div class="flex items-center mb-4">
                    <img src="<span class="math-inline">\{teacher\.image\}" alt\="</span>{teacher.name}" class="w-20 h-20 sm:w-24 sm:h-24 rounded-full mr-4 object-cover border-2 border-green-200">
                    <div class="flex-grow">
                        <h3 class="text-lg sm:text-xl font-bold text-green-900"><span class="math-inline">\{teacher\.name\}</h3\>
                        <p id\="top\-vote\-</span>{teacherId}" class="text-green-600 font-semibold"></p>
                    </div>
                </div>`;
            
            const chartHtml = `<div class="flex-grow flex items-center justify-center"><canvas id="chart-${teacherId}"></canvas></div>`;
            card.innerHTML = infoHtml + chartHtml;
            summaryContainer.appendChild(card);
            
            const voteCounts = teacherResult.votes;
            const labels = Object.values(voteOptions);
            const data = Object.keys(voteOptions).map(key => voteCounts[key] || 0);

            let maxVotes = 0;
            let topVoteIndex = -1;
            let totalVotes = 0;
            data.forEach((count, index) => {
                totalVotes += count;
                if (count > maxVotes) {
                    maxVotes = count;
                    topVoteIndex = index;
                }
            });
            
            const topVoteEl = document.getElementById(`top-vote-${teacherId}`);
            if (topVoteIndex !== -1) {
                topVoteEl.textContent = `สายเด่น: ${voteOptions[topVoteIndex + 1]}`;
            } else {
                 topVoteEl.textContent = 'ยังไม่มีผลโหวต';
            }

            if (totalVotes > 0) {
                new Chart(document.getElementById(`chart-${teacherId}`), {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ผลโหวต',
                            data: data,
                            backgroundColor: chartColors,
                            borderColor: '#ffffff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false 
                            }
                        }
                    }
                });
            } else {
                 document.getElementById(`chart-${teacherId}`).outerHTML = '<p class="text-center text-gray-500 flex-grow flex items-center justify-center">ยังไม่มีข้อมูลกราฟ</p>';
            }
        });
    
    </script>
</body>
</html>

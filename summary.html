<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สรุปผลโหวต</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="min-h-screen">
        <header class="bg-blue-600 text-white shadow-lg">
            <div class="container mx-auto py-6 px-4">
                 <h1 class="text-3xl md:text-4xl font-bold text-center">สรุปผลโหวตครูดีศรี ส.ว.</h1>
            </div>
        </header>
        <main class="container mx-auto px-4 py-8">
            <div id="loading" class="text-center">
                <p class="text-xl text-blue-700">กำลังโหลดข้อมูลสรุปผล...</p>
            </div>
            <div id="main-content" class="hidden">
                <h2 class="text-2xl font-semibold text-blue-800 mb-4 text-center">เลือกกลุ่มสาระเพื่อดูผลสรุป</h2>
                <div id="subject-selector" class="flex flex-wrap gap-2 mb-8 justify-center"></div>
                <h3 id="summary-subject-title" class="text-2xl font-bold text-blue-800 mb-6 text-center"></h3>
                <div id="summary-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>
        </main>
    </div>

<script>
    // ===================================================================
    //  สำคัญ! แก้ไข URL ตรงนี้เป็น Web App URL เดียวกับไฟล์ script.js
    // ===================================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbye0lPT3J6Clg9N6aQCl-S2z68z4qgM-4cRp7yrH6YhpHewR2L3wgHdkaxFhhDqcn67hg/exec";
    
    // ===================================================================
    //  สำคัญ! ข้อมูลส่วนนี้ต้องถูกคัดลอกมาจากไฟล์ script.js
    // ===================================================================
    const teachersData = {
        math: [
        { id: 'math1', name: 'นางสาวปณิชา  น้ำแก้ว', image: '49 panicha.png' },
        { id: 'math2', name: 'นางสุมีนา  ทับเนียม', image: '16 sumeena.png' },
        { id: 'math3', name: 'นางสาวสุดา  สมอแก้ว', image: '31 suda.png' },
        { id: 'math4', name: 'นางสาวบงกชกุล  วงษ์สีทอง', image: '32 bongkodkul.png' },
        { id: 'math5', name: 'นายทรงเกียรติ มณีโชติชุติมา', image: '51 shongkeirt.png' },
        { id: 'math6', name: 'นางสาวกองกาญจน์ ทิพย์จันทร์', image: '33 krongkarn.png' },
        { id: 'math7', name: 'นางสาวเพ็ญพิชชา  วรศักตยานันต์', image: '34 penphicha.png' },
        { id: 'math8', name: 'นางสาวพิศุทธิ์  แย้มบุตร', image: '35 pisut.png' },
        { id: 'math9', name: 'นางสาวศิริพร  สุขเกษม', image: '55 siriporn.png' },
        { id: 'math10', name: 'นางสาวธีร์วรา ทับชุม', image: '25 treewara.png' },
        { id: 'math11', name: 'นางสาวณัฎฐริณี ช่วยคง', image: '27 nattharanee.png' }
    ],
    science: [
        { id: 'sci1', name: 'นางจันทร์เพ็ญ  ศรีภุมมา', image: '60 janpeng.png' },
        { id: 'sci2', name: 'นายณัฐวุฒิ  วรรณโชติ', image: '67 natthawut.png' },
        { id: 'sci3', name: 'นางสาวภาณุมาศ  นักษัตรมณฑล', image: '17 panumas.png' },
        { id: 'sci4', name: 'นายนัสรี สาและ', image: '54 natsaree.png' },
        { id: 'sci5', name: 'นางสาวณัฐกฤตา  รองพล', image: '61 natthakitra.png' },
        { id: 'sci6', name: 'นางสาวเรณู  อรุณประสิทธิชัย', image: '65 renu.png' },
        { id: 'sci7', name: 'นางสาวสุทธิกานต์  เหรียญทอง', image: '72 suthikarn.png' },
        { id: 'sci8', name: 'นางสาวจิณณ์ณณัช  ธาราจิรเศรษฐ์', image: '63 jinnanat.png' },
        { id: 'sci9', name: 'นางณัฐนรี  แขวงโสภา', image: '73 natnaree.png' },
        { id: 'sci10', name: 'นางสาวระพีพัชร  อินทรโชติ', image: '64 rapreepat.png' },
        { id: 'sci11', name: 'นางสาวลักษิกา  ผลพิมาย', image: '59 luksika.png' },
        { id: 'sci12', name: 'นางสาวธนาภรณ์  เจริญผล', image: '53 thanaporn.png' },
        { id: 'sci13', name: 'นางสาวพิมชนก  เจริญชีพ', image: '62 pimchanok.png' },
        { id: 'sci14', name: 'นายสุนทร อุ่นทวี', image: '42 sunthon.png' },
        { id: 'sci15', name: 'นายสุพจน์  วิจิตรเวชการ', image: '78 suphod.png' },
        { id: 'sci16', name: 'นายปกรณ์ บริบูรณ์ทรัพย์', image: '44 pakorn.png' },
        { id: 'sci17', name: 'นายพงศ์พัทธ์  เจริญลาภลอย', image: '79 pongpat.png' },
        { id: 'sci18', name: 'นายภควรรษ  รัตนภานพ', image: '68 pakkawat.png' },
        { id: 'sci19', name: 'นายอัษฎา สังขะจาย', image: '66 atsada.png' },
        { id: 'sci20', name: 'นางสาวศศิธร ตรีพิมล', image: '89 sasithon.png' }
    ],
    thai: [
        { id: 'thai1', name: 'นางสาวสุชิรา แสงทองอร่าม', image: '2. suchira.png' },
        { id: 'thai2', name: 'นางพรอุมา แก้วจิตต์', image: '3. ponduma.png' },
        { id: 'thai3', name: 'นางสาวปรารถนา จันทร์ไทย', image: '4. pradthana.png' },
        { id: 'thai4', name: 'นางณัฐิกา ปัตยุรักษ์', image: '8 natthika.png' },
        { id: 'thai5', name: 'นางสาวกันยกานต์ จันชนะ', image: '15 kanyakan.png' },
        { id: 'thai6', name: 'นายเฉลิมศักดิ์ ลาภส่งผล', image: '82 charemsak.png' },
        { id: 'thai7', name: 'นางสาวเปรมจิต ชินวงษ์', image: '18 pramjit.png' },
        { id: 'thai8', name: 'นางสาวประเทือง บัวเผื่อน', image: '76 pratheng.png' },
        { id: 'thai9', name: 'นางสาวนงลักษณ์ แดงเพ็ง', image: '13 nongruk.png' },
        { id: 'thai10', name: 'นางสาวปัณฑิตา พูลสวัสดิ์', image: '38 panthita.png' }
    ],
    foreign: [
        { id: 'foreign1', name: 'นางอริสา ขันโฑ', image: '23 arisa.png' },
        { id: 'foreign2', name: 'นางจำนงจิต ยะโสธร', image: '77 jomnongjit.png' },
        { id: 'foreign3', name: 'นางสาวสังวาลย์ จันละมูล', image: '50 sangwan.png' },
        { id: 'foreign4', name: 'นางสาวทยากร ศักดิ์ศรีเท้า', image: '36 thayakorn.png' },
        { id: 'foreign5', name: 'นางสาวอจิระวดี ไชยบุตร', image: '40 ajirawadee.png' },
        { id: 'foreign6', name: 'นางสาวธนิตา เผ่าพงศ์ษา', image: '24 thanitra.png' },
        { id: 'foreign7', name: 'นายศิลปิน ทิพย์นพคุณ', image: '30 sinlapin.png' },
        { id: 'foreign8', name: 'นายธนวัฒน์ โพธิรัชต์', image: '26 thanawat.png' },
        { id: 'foreign9', name: 'นางสาวสุจิรา สุวรรณนัง', image: '22 sujira.png' },
        { id: 'foreign10', name: 'นางสาวพิราวรรณ ทองปาน', image: '39 pilawan.png' },
        { id: 'foreign11', name: 'นางสาวฉัตรรดา ประเสริฐศรี', image: '28 chatrada.png' },
        { id: 'foreign12', name: 'นางสาวปัทมาวดี นิลประดับ', image: '29 pathamawadee.png' },
        { id: 'foreign13', name: 'นางสาวปพิชญา กลับประดิษฐ', image: '90 papichaya.png' },
        { id: 'foreign14', name: 'Ms. Nerissa  J.  Denilla', image: '86 Nerissa.png' },
        { id: 'foreign15', name: 'Mr. Steven J Walden', image: '83 Steven.png' },
        { id: 'foreign16', name: 'Ms. Emily  Mirembe', image: '85 Emily.png' },
        { id: 'foreign17', name: 'Mr. Rusty Nino Felipe Mercado', image: '87 Rusty.png' },
        { id: 'foreign18', name: 'Ms. Patricia Maxine Dazo Vergara', image: '84 Patricia.png' },
        { id: 'foreign19', name: 'Miss.Ceng Jia qi', image: '91 Ceng Jia qi.png' }
    ],
    social: [
        { id: 'soc1', name: 'นายชุมสิน กาญจนทอง', image: '5 chumsin.png' },
        { id: 'soc2', name: 'นางสาวรวิปรียา เทศแย้ม', image: '7 rawipreeya.png' },
        { id: 'soc3', name: 'นางสาวบุบผา บุญส่ง', image: '69 buppha.png' },
        { id: 'soc4', name: 'นางสาวภัทรานิษฐ์ แปงต่อม', image: '19 patthranit.png' },
        { id: 'soc5', name: 'นางสาวพรทิพย์ แดงชาติแท้', image: '52 pornthip.png' },
        { id: 'soc6', name: 'นายสุระศักดิ์ ด้วงขวิด', image: '1. surasuk.png' },
        { id: 'soc7', name: 'นายธีรศักดิ์ ชลรัตน์อมฤต', image: '41 threerasuk.png' },
        { id: 'soc8', name: 'ว่าที่ร้อยตรี อนันต์ ชูช่วย', image: '57 anan.png' },
        { id: 'soc9', name: 'นายจีรยศ สินธุวงษานนท์', image: '6 jirayod.png' },
        { id: 'soc10', name: 'นางสาวจรรยา สุขขา', image: '20 juanya.png' }
    ],
    pe: [
        { id: 'pe1', name: 'นายนันทวัฒน์ พรมหาชัย', image: '81 nanthawat.png' },
        { id: 'pe2', name: 'นางพรรณี ครุฑเสม', image: '12 pannee.png' },
        { id: 'pe3', name: 'นายณัฐวุฒิ เชื้อปรางค์', image: '80 natthawut.png' },
        { id: 'pe4', name: 'นายอาชาวิน บุญเกิด', image: '14 archawin.png' },
        { id: 'pe5', name: 'นายทวีเกียรติ วงแหวน', image: '21 thaweekieat.png' }
    ],
    career: [
        { id: 'car1', name: 'นางนฤภร ราชานาค', image: '48 nareupon.png' },
        { id: 'car2', name: 'นางชนัญกาญจน์ หอมกลิ่น', image: '43 chanankarn.png' },
        { id: 'car3', name: 'นายโชติปกรณ์ ขวัญมงคล', image: '37 chothipakorn.png' },
        { id: 'car4', name: 'นางราตรี อรชร', image: '46 ratree.png' },
        { id: 'car5', name: 'นางสาวสาวิตรี วงษ์สวรรค์', image: '45 sawitree.png' },
        { id: 'car6', name: 'นางสาวปัทมา โสภาเลิศ', image: '58 phathama.png' },
        { id: 'car7', name: 'นางสาวสุรางคนา ยงสุวรรณ', image: '70 surangkana.png' },
        { id: 'car8', name: 'นางสาวอัญศิกานต์ ยิ้มภากรณ์', image: '47 unsikarn.png' }
    ],
    art: [
        { id: 'art1', name: 'นายตฤณ คงอยู่สุข', image: '56 trin.png' },
        { id: 'art2', name: 'นายพลวัชร สำเรียนรัมย์', image: '71 ponlawat.png' },
        { id: 'art3', name: 'นายปณิธิ คุ้มทรัพย์', image: '75 panithi.png' },
        { id: 'art4', name: 'นางสาวดาวรุ่ง เย็นใส', image: '74 dowrung.png' },
        { id: 'art5', name: 'นายไพศาล คำหอม', image: '88 paisan.png' }
    ],
    guidance: [
        { id: 'gui1', name: 'นางกันยนา สุรชิต', image: '10 kanyana.png' },
        { id: 'gui2', name: 'นางลักขณา โพธิ์ทองโชติกุล', image: '11 rukkana.png' },
        { id: 'gui3', name: 'นางสาวประภาภรณ์ รุ่งเรือง', image: '9 prapapon.png' }
        ]
    };
    const subjectNames = {
        math: 'คณิตศาสตร์',
        science: 'วิทยาศาสตร์และเทคโนโลยี',
        thai: 'ภาษาไทย',
        foreign: 'ภาษาต่างประเทศ',
        social: 'สังคมศึกษา',
        pe: 'สุขศึกษาและพลศึกษา',
        career: 'การงานอาชีพ',
        art: 'ศิลปะ',
        guidance: 'แนะแนว'
    };
    const voteOptions = {
        1: 'สายตรงเวลา',
        2: 'สายตั้งใจสอน',
        3: 'สายสอนเกินคาบ',
        4: 'สายข้อสอบโหด',
        5: 'สายเจ้าระเบียบ',
        6: 'สายเข้าใจนักเรียน',
        7: 'สายใจดีมีเมตตา',
        8: 'สายบันเทิง',
        9: 'สายเทคโนโลยี'
    };

    // --- โค้ดส่วนที่เหลือสำหรับดึงข้อมูลและแสดงผล ---
    const loadingDiv = document.getElementById('loading');
    const mainContentDiv = document.getElementById('main-content');
    const subjectSelector = document.getElementById('subject-selector');
    const summaryContainer = document.getElementById('summary-container');
    const summarySubjectTitle = document.getElementById('summary-subject-title');

    const chartColors = [
        '#4ade80', '#facc15', '#fb923c', '#f87171', '#60a5fa',
        '#c084fc', '#f472b6', '#34d399', '#a78bfa'
    ];

    document.addEventListener('DOMContentLoaded', () => {
        // เพิ่มการตรวจสอบค่าว่างของ teachersData
        if (!teachersData || Object.keys(teachersData).length === 0) {
            loadingDiv.innerHTML = `<p class="text-xl text-red-600">เกิดข้อผิดพลาด: ไม่พบข้อมูล teachersData ในสคริปต์ กรุณาคัดลอกข้อมูลจาก script.js มาวางให้ครบถ้วน</p>`;
            return;
        }

        fetch(SCRIPT_URL)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText}`);
                }
                return response.json();
            })
            .then(summaryData => {
                loadingDiv.classList.add('hidden');
                mainContentDiv.classList.remove('hidden');
                
                Object.keys(teachersData).forEach(subjectKey => {
                    const button = document.createElement('button');
                    button.textContent = subjectNames[subjectKey];
                    button.className = 'btn-subject bg-white border-2 border-blue-500 rounded-lg py-2 px-4 text-blue-700 font-medium shadow-md hover:bg-blue-50';
                    button.onclick = () => showSummary(subjectKey, summaryData);
                    subjectSelector.appendChild(button);
                });
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                loadingDiv.innerHTML = `<p class="text-xl text-red-600">เกิดข้อผิดพลาดในการโหลดข้อมูล: ${error.message}<br><span class="text-base text-gray-600">กรุณาตรวจสอบ URL, การตั้งค่า Deploy (ต้องเป็น Anyone), และการเชื่อมต่ออินเทอร์เน็ต</span></p>`;
            });
    });

    function showSummary(subjectKey, summaryData) {
    summaryContainer.innerHTML = '';
    summarySubjectTitle.textContent = `ผลสรุปกลุ่มสาระ: ${subjectNames[subjectKey]}`;
    
    const subjectTeachers = teachersData[subjectKey];
    const subjectSummary = summaryData[subjectNames[subjectKey]] || {};

    if (!subjectTeachers || subjectTeachers.length === 0) {
        summaryContainer.innerHTML = '<p class="text-center col-span-full">ไม่พบข้อมูลคุณครูในกลุ่มสาระนี้</p>';
        return;
    }

    subjectTeachers.forEach(teacher => {
        const teacherId = teacher.id;
        const teacherResult = subjectSummary[teacherId] || { name: teacher.name, votes: {} };
        
        const card = document.createElement('div');
        card.className = 'bg-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col';
        
        // ==========================================================
        //  !!! ตรวจสอบว่าบรรทัดนี้เริ่มต้นและจบด้วย Backtick (`) !!!
        // ==========================================================
        const infoHtml = `
            <div class="flex items-center mb-4">
                <img src="${teacher.image}" alt="${teacher.name}" class="w-20 h-20 sm:w-24 sm:h-24 rounded-full mr-4 object-cover border-2 border-blue-200">
                <div class="flex-grow">
                    <h3 class="text-lg sm:text-xl font-bold text-blue-900">${teacher.name}</h3>
                    <p id="top-vote-${teacherId}" class="text-blue-600 font-semibold"></p>
                </div>
            </div>`;
        
        const chartHtml = `<div class="flex-grow flex items-center justify-center"><canvas id="chart-${teacherId}"></canvas></div>`;
        card.innerHTML = infoHtml + chartHtml;
        summaryContainer.appendChild(card);
        
        const voteCounts = teacherResult.votes;
        const labels = Object.values(voteOptions);
        const data = Object.keys(voteOptions).map(key => voteCounts[key] || 0);

        let maxVotes = 0;
        let topVoteIndex = -1;
        let totalVotes = 0;
        data.forEach((count, index) => {
            totalVotes += count;
            if (count > maxVotes) {
                maxVotes = count;
                topVoteIndex = index;
            }
        });
        
        const topVoteEl = document.getElementById(`top-vote-${teacherId}`);
        if (topVoteIndex !== -1) {
            topVoteEl.textContent = `สายเด่น: ${voteOptions[topVoteIndex + 1]}`;
        } else {
             topVoteEl.textContent = 'ยังไม่มีผลโหวต';
        }

        if (totalVotes > 0) {
            new Chart(document.getElementById(`chart-${teacherId}`), {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ผลโหวต',
                        data: data,
                        backgroundColor: chartColors,
                        borderColor: '#ffffff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false 
                        }
                    }
                }
            });
        } else {
             document.getElementById(`chart-${teacherId}`).outerHTML = '<p class="text-center text-gray-500 flex-grow flex items-center justify-center">ยังไม่มีข้อมูลกราฟ</p>';
        }
    });
}

        subjectTeachers.forEach(teacher => {
            const teacherId = teacher.id;
            const teacherResult = subjectSummary[teacherId] || { name: teacher.name, votes: {} };
            
            const card = document.createElement('div');
            card.className = 'bg-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col';
            
            const infoHtml = `
                <div class="flex items-center mb-4">
                    <img src="<span class="math-inline">\{teacher\.image\}" alt\="</span>{teacher.name}" class="w-20 h-20 sm:w-24 sm:h-24 rounded-full mr-4 object-cover border-2 border-blue-200">
                    <div class="flex-grow">
                        <h3 class="text-lg sm:text-xl font-bold text-blue-900"><span class="math-inline">\{teacher\.name\}</h3\>
                        <p id\="top\-vote\-</span>{teacherId}" class="text-blue-600 font-semibold"></p>
                    </div>
                </div>`;
            
            const chartHtml = `<div class="flex-grow flex items-center justify-center"><canvas id="chart-${teacherId}"></canvas></div>`;
            card.innerHTML = infoHtml + chartHtml;
            summaryContainer.appendChild(card);
            
            const voteCounts = teacherResult.votes;
            const labels = Object.values(voteOptions);
            const data = Object.keys(voteOptions).map(key => voteCounts[key] || 0);

            let maxVotes = 0;
            let topVoteIndex = -1;
            let totalVotes = 0;
            data.forEach((count, index) => {
                totalVotes += count;
                if (count > maxVotes) {
                    maxVotes = count;
                    topVoteIndex = index;
                }
            });
            
            const topVoteEl = document.getElementById(`top-vote-${teacherId}`);
            if (topVoteIndex !== -1) {
                topVoteEl.textContent = `สายเด่น: ${voteOptions[topVoteIndex + 1]}`;
            } else {
                 topVoteEl.textContent = 'ยังไม่มีผลโหวต';
            }

            if (totalVotes > 0) {
                new Chart(document.getElementById(`chart-${teacherId}`), {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ผลโหวต',
                            data: data,
                            backgroundColor: chartColors,
                            borderColor: '#ffffff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false 
                            }
                        }
                    }
                });
            } else {
                 document.getElementById(`chart-${teacherId}`).outerHTML = '<p class="text-center text-gray-500 flex-grow flex items-center justify-center">ยังไม่มีข้อมูลกราฟ</p>';
            }
        });
    
    </script>
</body>
</html>
